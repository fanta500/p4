<!DOCTYPE html>
<html>
    <head>
        <title>p4v Test</title>
        <!-- data-main attribute tells require.js to load
             scripts/main.js after require.js loads. -->
        <style>
        .i2v-viz {
          -webkit-touch-callout: none; /* iOS Safari */
            -webkit-user-select: none; /* Safari */
             -khtml-user-select: none; /* Konqueror HTML */
               -moz-user-select: none; /* Firefox */
                -ms-user-select: none; /* Internet Explorer/Edge */
                    user-select: none; /* Non-prefixed version, currently
                                          supported by Chrome and Opera */
        }

        .i2v-axis-label {
            font-size: 18px;
        }
        </style>
    </head>
    <body>
        <h1>P4v Test</h1>
        <div id="i2vCanvas">

        </div>

        <script src="/npm/requirejs/require.js"></script>
        <script>
        require([
            "p4/io/ajax",
            "p4/io/parser",
            "p4/cquery/ctypes",
            "p4/cquery/cstore",
            "p4/core/datastruct",
            "p4/core/pipeline",
            "p4/core/arrays",
            "../src/adav",
            // "glCompute",
        ],
        function(
            ajax,
            parser,
            ctypes,
            CStore,
            dataStruct,
            pipeline,
            arrays,
            adav
            // glCompute
        ){
            ajax.getAll([
                 {url: "../Nat200k.csv", dataType: "text"},
            ]).then(function(response){
                var csv = parser(response[0], ',');
                var db = CStore({
                    size: csv.length,
                    struct: {
                        Month: "int",
                        Time: "int",
                        DayOfWeek: "int",
                        MotherAge: "int",
                        MotherRace: "string",
                        MotherMartialStatus: "string",
                        MotherEducation: "string",
                        FatherAge: "int",
                        FatherRace: "string",
                        FatherEducation: "string",
                        MotherHeight: "float",
                        MotherWeight: "float",
                        MotherWeightGain: "int",
                        BabyGender: "string",
                        BabyWeight: "float"
                    },
                });

                db.addRows(csv);

                var data = db.data();
                data.stats = db.stats();

                var test = adav({
                    config: {
                        viewport: [1200, 800],
                        padding: {left: 100, right: 30, top:30, bottom: 30}
                    },
                    views: [
                        {
                            width: 900,
                            height: 320,
                            offset: [0, 0]
                        },
                        // {
                        //     width: 400,
                        //     height: 380,
                        //     offset: [480, 420]
                        // },
                        // {
                        //     width: 400,
                        //     height: 380,
                        //     offset: [0, 420]
                        // }
                    ],
                    data: data
                });
                //
                var result = test
                // .filter({
                //     MotherAge: [10, 44],
                //     FatherAge: [20, 44],
                //     BabyWeight: [200, 6600],
                //     MotherWeight: [80,300]
                // })
                .visualize({
                    mark: 'line',
                    id: 'parallel-coordinate',
                    // x: 'BabyWeight',
                    // y: 'MotherWeight',
                    alpha: 0.1,
                    // color: 'steelblue',
                    y: ['MotherWeight', 'MotherAge', 'MotherHeight', 'MotherRace', "MotherEducation"],
                    // perceptual: true,
                    // brush: 'update'
                })
                // .visualize({
                //     id: 'scatter',
                //     mark: 'point',
                //     x: 'BabyWeight',
                //     y: 'MotherWeight'
                // })
                // .aggregate({
                //     $group: ['FatherAge'],
                //     babyCount: {$count: '*'}
                // })
                // .visualize({
                //     id: '2d-heatmap',
                //     mark: 'bar',
                //     x: 'FatherAge',
                //     y: 'babyCount'
                // })
                // .visualize({
                //     mark: 'point',
                //     id: 0,
                //     x: 'BabyWeight',
                //     y: 'MotherWeight',
                //     alpha: 0.35,
                //     // color: 'steelblue',
                //     // brush: 'update'
                // })
                // .aggregate({
                //     $group: 'MotherRace',
                //     babyCount: {$count: '*'}
                // })
                // .visualize({
                //     id: 1,
                //     mark: 'bar',
                //     scale: {power: 0.5},
                //     x: 'MotherRace',
                //     y: 'babyCount'
                // })
                // .visualize({
                //     mark: 'line',
                //     id: 1,
                //     // x: 'BabyWeight',
                //     // y: 'MotherWeight',
                //     alpha: 0.33,
                //     color: 'red',
                //     y: ['MotherWeight', 'MotherAge', 'FatherAge', 'MotherHeight', 'MotherRace', "MotherEducation"],
                //     // perceptual: false,
                //     brush: 'update'
                // });


                // test
                // .filter({
                //     // MotherAge: [20, 44],
                //     // FatherAge: [20, 44],
                //     BabyWeight: [200, 6600],
                //     MotherWeight: [90,300],
                //     // MotherEducation: [1, 2]
                // })
                // .visualize({
                //     mark: 'point',
                //     id: 2,
                //     x: 'BabyWeight',
                //     y: 'MotherWeight',
                //     alpha: 0.33,
                //     color: 'BabyGender',
                // })
                // .visualize({
                //     mark: 'line',
                //     id: 1,
                //     // x: 'BabyWeight',
                //     // y: 'MotherWeight',
                //     // alpha: 0.15,
                //     color: 'red',
                //     y: ['BabyWeight', 'MotherAge', 'MotherWeight', 'MotherHeight', 'MotherRace'],
                //     // perceptual: true,
                //     brush: 'update'
                // })
                // // .head()
                // .aggregate({
                //     $by: ["FatherRace"],
                //     BabyCount : {$count: "*"},
                // })
                // .visualize({
                //     id: 0,
                //     mark: "bar",
                //     x: "FatherRace",
                //     y: "BabyCount"
                // })
                // .read();


                // test.branch([
                //     {
                //         aggregate: {
                //             $group: ["MotherEducation"],
                //             BabyCount : {$count: "*"},
                //         },
                //         visualize: {
                //             id: 2,
                //             mark: "bar",
                //             x: "MotherEducation",
                //             y: "BabyCount"
                //         }
                //     },
                //     {
                //         aggregate: {
                //             $group: ["FatherEducation"],
                //             BabyCount : {$count: "*"},
                //         },
                //         visualize: {
                //             id: 1,
                //             mark: "bar",
                //             x: "FatherEducation",
                //             y: "BabyCount"
                //         }
                //     },
                // ])

                //
                // test
                // // .filter({
                // //     // MotherAge: [20, 44],
                // //     // FatherAge: [20, 44],
                // //     BabyWeight: [200, 6600],
                // //     MotherWeight: [90,300],
                // //     // MotherEducation: [1, 2]
                // // })
                // // .aggregate({
                // //     $by: ["MotherRace", "MotherEducation"],
                // //     BabyCount : {$sum: "BabyWeight"},
                // // })
                // // .aggregate({
                // //     $by: ["MotherRace"],
                // //     BabyCount : {$sum: "BabyCount"},
                // // })
                // .aggregate({
                //     $by: ["MotherRace"],
                //     BabyCount : {$sum: "BabyWeight"},
                // })
                // .visualize({
                //     id: 0,
                //     mark: "bar",
                //     x: "MotherRace",
                //     y: "BabyCount",
                //     // interact: function(d) {
                //     //     test.update()
                //     //     .filter(d)
                //     //     .aggregate({
                //     //         $by: ["MotherEducation"],
                //     //         BabyCount : {$count: "*"},
                //     //     })
                //     //     .visualize({
                //     //         id: 1,
                //     //         mark: "bar",
                //     //         x: "MotherEducation",
                //     //         y: "BabyCount",
                //     //     })
                //     // }
                // })
                // .head()
                // .aggregate({
                //     $by: ["MotherEducation"],
                //     BabyCount : {$count: "*"},
                // })
                // .visualize({
                //     id: 1,
                //     mark: "bar",
                //     x: "MotherEducation",
                //     y: "BabyCount",
                //     // interact: function(d) {
                //     //     test.update()
                //     //     .filter(d)
                //     //     .aggregate({
                //     //         $by: ["FatherRace"],
                //     //         BabyCount : {$count: "*"},
                //     //     })
                //     //     .visualize({
                //     //         id: 0,
                //     //         mark: "bar",
                //     //         x: "FatherRace",
                //     //         y: "BabyCount",
                //     //     })
                //     // }
                // });

                test.pipeline();
            });
        });
        </script>
    </body>
</html>
